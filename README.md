# Magnit Mobile API Parser ‚Äî –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–ö–æ—Ñ–µ"

–ü–∞—Ä—Å–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ **"–ö–æ—Ñ–µ"** –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ú–∞–≥–Ω–∏—Ç —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

‚ö†Ô∏è –í–∞–∂–Ω–æ:
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (`middle-api.magnit.ru`)
- –ü–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (Bearer-—Ç–æ–∫–µ–Ω –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- –í –≤—ã–≥—Ä—É–∑–∫—É –ø–æ–ø–∞–¥–∞—é—Ç **—Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏**

---

## üì¶ –ß—Ç–æ –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è

CSV-—Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| id | ID —Ç–æ–≤–∞—Ä–∞ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| name | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ |
| regular_price | –†–µ–≥—É–ª—è—Ä–Ω–∞—è —Ü–µ–Ω–∞ |
| promo_price | –¶–µ–Ω–∞ –ø–æ –∞–∫—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å) |
| brand | –ë—Ä–µ–Ω–¥ |
| city | –ì–æ—Ä–æ–¥ |

---

## üîê –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∏ device-id

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ Charles / mitmproxy / Proxyman).

–í –∑–∞–ø—Ä–æ—Å–∞—Ö –∫:

```
https://middle-api.magnit.ru
```

–Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏:

```
authorization: bearer <JWT_TOKEN>
x-device-id: <UUID>
```

–≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞.

---

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞

–ü—Ä–∏–º–µ—Ä –¥–ª—è –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞:

```bash
python magnit_parser.py \
  --city "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥" \
  --out coffee_spb.csv \
  --token <bearer> \
  --device-id <x-device-id>
```

–ü—Ä–∏–º–µ—Ä –¥–ª—è –ú–æ—Å–∫–≤—ã:

```bash
python magnit_parser.py \
  --city "–ú–æ—Å–∫–≤–∞" \
  --out coffee_moscow.csv \
  --token <bearer> \
  --device-id <x-device-id>
```

---

## ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------------|----------|
| `--city` | –î–∞ | –ì–æ—Ä–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `"–ú–æ—Å–∫–≤–∞"` –∏–ª–∏ `"–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥"`) |
| `--out` | –î–∞ | –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ CSV-—Ñ–∞–π–ª–∞ |
| `--token` | –î–∞ | Bearer JWT —Ç–æ–∫–µ–Ω –∏–∑ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| `--device-id` | –î–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `x-device-id` |

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `--app-version` | –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8.90.0) |
| `--user-agent` | User-Agent (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é okhttp/5.1.0) |
| `--limit` | –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20) |

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω CSV-—Ñ–∞–π–ª:

```
coffee_spb.csv
```

–§–∞–π–ª –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ UTF-8 (—Å BOM) –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ Excel.

---

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä—Å–µ—Ä

1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–æ—Ä–æ–¥ —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç:
   ```
   POST /market/v2/city/info
   ```

2. –ü–æ–ª—É—á–∞–µ—Ç ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–ö–æ—Ñ–µ":
   ```
   GET /v3/categories/store/000
   ```

3. –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
   ```
   POST /v2/goods/search
   ```

4. –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã:
   - –¢–æ–ª—å–∫–æ `quantity > 0` (–≤ –Ω–∞–ª–∏—á–∏–∏)

---

## ‚ùó –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

### 401 Unauthorized
–¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫. –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –Ω–æ–≤—ã–π Bearer-—Ç–æ–∫–µ–Ω –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### 400 / 403
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å `device-id` –∏ `token`.

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ

–¢–æ–∫–µ–Ω –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏.  
–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## üõ† –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

Python 3.9+

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
pip install requests
```

---

–ì–æ—Ç–æ–≤–æ üöÄ
